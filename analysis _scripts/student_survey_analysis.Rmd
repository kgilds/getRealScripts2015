---
title: "student_survey_analysis"
author: "Kevin Gilds"
date: "`r Sys.Date()`"
output: 
  html_document: 
    toc: yes
---




```{r import libaries, echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(dplyr)
library(pander)
library(ggplot2)
library (ezknitr)
library(formattable)
library(sqldf)
library(psych)
library(knitr)
setwd("C:/Users/kevin/Dropbox/GetReal/Data/sqlite")


### Make connection with database
getReal_2016db<- dbConnect(SQLite(), dbname="outcome_history.sqlite")




```


```{r load outcome survesy, echo=FALSE}

### Reade the girl_pre_survey database for analysis. 
outcomes <- dbReadTable(getReal_2016db, "girl_pre")
###Select the variables of interest from the pre_survey
outcomes <- select(outcomes, girlCode, council, hr.avg, am.avg, ae.avg)

history <- dbReadTable(getReal_2016db, "basic_view")


```




```{r lastyeardata, echo=FALSE}

setwd("C:/Users/kevin/Dropbox/GetReal/Reports/MY-2014-2015/Summ Evaluation Report/data")
getRealdb<- dbConnect(SQLite(), dbname="data_Final_GetReal_2014_2015.sqlite")

pre_survey_2014 <- dbReadTable(getRealdb, "pre_girl_survey")

dim(pre_survey_2014)

post_survey_MY1415 <- dbReadTable(getRealdb, "post_girl_survey")

dim(post_survey_MY1415)


```


```{r}

### Match Pre Surveys

pre_merge <- inner_join (pre_survey_2014, outcomes, by = "girlCode", Copy=FALSE)

dim(pre_merge)

#x=2014, y=2015


```



### Match Post Survey (Matched Post Surveys Spring 2015 and Fall 2015)

```{r}

post_merge <- inner_join(post_survey_MY1415, outcomes, by = "girlCode", Copy=FALSE)

non_match <- anti_join(outcomes, post_survey_MY1415, by = "girlCode", Copy = FALSE)

dim(post_merge)

dim(non_match)




```







# Survey Analysis Basic 

## Healthy Releationships


```{r hr_function, echo=FALSE}

hr <- function(){
    hr_tbl <- with(outcomes,table(hr.avg >=4.45))
    pander(hr_tbl)
    
}
```





```{r hr_percent, echo=FALSE}

hr_percent <- function() {
    hr_tbl <- with(outcomes,table(hr.avg >=4.45))
    hr_tbl_p <- prop.table(hr_tbl)
    hr_tbl_p <- round(hr_tbl_p*100,2)
    pander(hr_tbl_p)
}

hr_percent()

```




### Healthy Relationships Outcome Tables
```{r hr outcome tables, echo=FALSE, eval=FALSE}
### create basic outcome table for healty releationship outcome

hr_tbl <- with(outcomes,table(hr.avg >=4.45))

### print in pretty table
pander(hr_tbl)

### Put percents with outcome table
hr_tbl_p <- prop.table(hr_tbl)


###Print percent table
pander(hr_tbl_p)

### Basic outcome table for healthy relationships by council
hr_tbl_c <- with(outcomes, table(council, hr.avg >=4.45))

### print results of outcome table
pander(hr_tbl_c)


####Percent by council

hr_tbl_cp <- prop.table(hr_tbl_c, 1)

### Print by percent
pander(hr_tbl_cp)


```

### Healthy Relationship Outcome Plots
```{r hr_barchart, fig.width=15, echo=FALSE}
### Plot outcome results
hr <- select(outcomes, council, hr.avg)
ggplot(hr, aes(hr.avg >=4.45)) + geom_bar(fill="blue", width = .5) + labs(x="Achieving at High Level", title = "Pre: Healthy Relationships")




```




```{r hr_hist2, echo=FALSE, eval=FALSE}

### Plot outcome results by council    
hr_hist <- ggplot(hr, aes(x=hr.avg))
        hr_hist + geom_histogram(fill="blue") +facet_grid(~council) + labs(x=" All Outcome Scores", title = "Pre: Healthy Relationships")

```




### Healthy Relationships Outcome Distribution Plots
```{r hr_hist, echo=FALSE}
### Histogram to show all the outcome scores
### Abline for ggplot
 hr_hist <- ggplot(hr, aes(x=hr.avg)) 
        hr_hist + geom_histogram(fill="blue") + labs(x=" All Outcome Scores", title = "Pre: Healthy Relationships")



        

```


```{r hr_boxplot, echo=FALSE, eval=FALSE}

### Box plot for outcome scores
        
hr_box <- ggplot(hr, aes(x=factor(council), hr.avg))
        hr_box + geom_boxplot(fill="blue") + labs(y=" All Outcome Scores", title = "Pre: Healthy Relationships")


```



### Healthy Relationships Descriptive Stats
```{r hr_descrip, echo=FALSE}
## Try x-table, or kable

### Prepare data frame for just looking at hr.avg        
hr_1 <- select(hr, hr.avg)

### Stat summary of df.
hr_des <- describe(hr_1)

kable(hr_des)
        
```


### Healthy Relationship Trends

```{r echo=FALSE}


hr_history <-
    select(history, Year,population, mean, sd, outcome.1) 

hr_history <-
    filter(hr_history, outcome.1 == "Healthy Relationships"& Year !="2015")


pander(hr_history)

```





### Healthy Relationship Skills for students in the program last year. 
```{r echo=FALSE}

post_merge_hr_pre <- describe(post_merge$hr.avg.y)

post_merge_hr_post <-describe(post_merge$hr.avg.x)

non_match_hr_pre <- describe(non_match$hr.avg)






```

#### Pre Survey Healthy Relationship Scores for students in the Program last year: 
```{r echo=FALSE}

kable(post_merge_hr_pre)
kable(post_merge_hr_post)

```


#### Pre Survey Health Relationship Scores for students not in the program last year:

```{r echo=FALSE}
kable(non_match_hr_pre)

```


## Academic Engagement


```{r echo=FALSE, eval=FALSE}
ae <- function() {
    ae_tbl <-with(outcomes,table(ae.avg >=4.5))
    pander(ae_tbl)
    
}

ae()
```





```{r echo = FALSE}
ae_percent <-function() {
    ae_tbl <-with(outcomes,table(ae.avg >=4.5))
    ae_p <-prop.table(ae_tbl)
    ae_p <-round(ae_p*100,2)
    pander(ae_p)
}

ae_percent()

```


```{r echo = FALSE}

### Prepare data frame for tables
ae <- select(outcomes, council, ae.avg)


```




### Academic Engagement Outcome Tables

```{r echo=FALSE, eval = FALSE}
### Prepare data frame for tables
ae <- select(outcomes, council, ae.avg)

### Create outcome tables
ae_tbl <-with(ae,table(ae.avg >=4.5))

### Print outcome table
pander(ae_tbl)

### Create percent outcome table
ae_tbl_p <- prop.table(ae_tbl)

### Print Outcome table
pander(ae_tbl_p)

### Make outcome table by council
ae_tbl_c <-with(ae,table(council, ae.avg >=4.5))

### Print Outcome table by council
pander(ae_tbl_c)

### Make outcome table by percent
ae_tbl_cp <- prop.table(ae_tbl_c,1)

### Print percent table. 
pander(ae_tbl_cp)



```

### Academic Engagment Outcome Plots

```{r fig.width=15, echo = FALSE}
###Create outcome plot 
ae_plot <-ggplot(ae, aes(ae.avg >= 4.5)) 
         ae_plot + geom_bar(fill="blue", width = .5) + labs(x="Achieving at High Level", title = "Pre: Academic Engagement"
                                                                               ) 


         
```


```{r echo=FALSE, eval= FALSE}

### Create outcome plot by council    
ae_hist <- ggplot(ae, aes(x=ae.avg))
        ae_hist + geom_histogram(fill="blue") +facet_grid(~council) + labs(x=" All Outcome Scores", title = "Pre: Healthy Relationships")

```



### Acedimc Engagement Distribution Plots

```{r echo = FALSE}

### Create Histogram of all outcome scores
ae_hist <- ggplot(ae, aes(ae.avg)) 
        ae_hist + geom_histogram(fill="blue") + labs(x="All Outcome Scores", title="Post: Academic Engagement")


```


### Academic Engagement Boxplot
```{r fig.width=20, echo=FALSE, eval=FALSE}

###Create box plot by council
ae_box <-ggplot(ae, aes(x=factor(council), ae.avg))
ae_box + geom_boxplot(fill="blue") + labs(y="All Outcome Scores", title = "Pre: Academic Engagement")
```

###  Academic Engagement Descriptive Stats

```{r echo = FALSE}
###Summary stats for academic engagement variable
ae_desc <- describe(ae$ae.avg)

###Make Summary table look nice
kable(ae_desc)
        
        
```



## Academic Mastery

```{r echo = FALSE, eval = FALSE}
am <- function() {
    am_tbl <-with(outcomes,table(am.avg >=4.8))
    pander(am_tbl)
}

am()


```


```{r echo=FALSE}
am_percent <-function() {
    am_table <-with(outcomes,table(am.avg >=4.8))
    am_p <-prop.table(am_table)
    am_p <-round(am_p*100,2)
    pander(am_p)
}
am_percent()

```

```{r echo = FALSE}

###Create data fram to set up outcome table
am <- select(outcomes, council, am.avg)

```



### Academic Mastery Outcome tables

```{r echo= FALSE, eval= FALSE}

###Create data fram to set up outcome table
am <- select(outcomes, council, am.avg)

###Create academic mastery outcome table
am_tbl <- with(am,table(am.avg >=4.8))


### Print outcome table
pander(am_tbl)

### Put percentage to counts
am_tbl_p <- prop.table(am_tbl)


### Print pretty percent table.
pander(am_tbl_p)

### Outcome count by table
am_c <- with(am,table(council, am.avg >=4.8))

### Print outcome table
pander(am_c)

#### Academic Mastery by outcome count by percent
am_cp <-prop.table(am_c,1)

#### Print outcome percent outcome table. 
pander(am_cp)

```


### Academic Mastery Outcome Plots

```{r fig.width=15, echo = FALSE}

### Plot outcome results for academic masters
am_plot <-ggplot(am, aes(am.avg >= 4.8)) 
         am_plot + geom_bar(fill="blue", width = .5) + labs(x="Achieving at High Level", title = "Pre: Academic Mastery") 
     
         


```


```{r echo = FALSE, eval= FALSE}

## Plot outcome results by council
am_hist <- ggplot(am, aes(x=hr.avg))
        hr_hist + geom_histogram(fill="blue") +facet_grid(~council) + labs(x=" All Outcome Scores", title = "Pre: Academic Mastery")

```



### Academic Mastery Distribution Plots

```{r echo = FALSE}

### Create histogram from academic mastery scores
am_hist <- ggplot(am, aes(am.avg)) 
        am_hist + geom_histogram(fill="blue") + labs(x="All Outcome Scores", title="Pre: Academic Mastery")
        


```



### Acadmeic Mastery Boxplot

```{r fig.width=15, echo = FALSE, eval = FALSE}
        
### Create box plot of academic master outcome scores. 
am_box <-ggplot(am, aes(x=factor(council), am.avg))
am_box + geom_boxplot(fill="blue") + labs(y="All Outcome Scores", title = "Pre: Academic Mastery")

```



### Academic Mastery Descriptive Stats
```{r echo = FALSE}

### Create stats summary
am_s <- describe(am$am.avg)

### Print summary with kable        
kable(am_s)
        
```

